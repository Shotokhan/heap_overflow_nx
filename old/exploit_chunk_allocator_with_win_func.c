#include <stdio.h>
#include <stdlib.h>


struct data {
  char name[128];
};

struct functions {
  void (*greeting)(char* name);
  void (*menu)();
  void (*choose_name)();
};

void call_system() {
  system("/bin/sh");
  exit(0);
}

void ita_greeting(char* name) {
  printf("Ciao %s!\n", name);
}

void en_greeting(char* name) {
  printf("Hello %s!\n", name);
}

void ita_menu() {
  printf("\n");
  printf("Cosa vuoi fare?\n");
  printf("[1] Cambia nome\n");
  printf("[2] Cambia lingua\n");
  printf("[3] Esci\n");
  printf("> ");
}

void en_menu() {
  printf("\n");
  printf("What do you want to do?\n");
  printf("[1] Change name\n");
  printf("[2] Change language\n");
  printf("[3] Exit\n");
  printf("> ");
}

void ita_choose_name() {
  printf("\n");
  printf("Qual Ã¨ il tuo nome?\n");
  printf("> ");
}

void en_choose_name() {
  printf("\n");
  printf("What's your name?\n");
  printf("> ");
}

void choose_language(struct functions** f) {
  int choice;
  do {
    printf("\n");
    printf("Choose language:\n");
    printf("[1] English\n");
    printf("[2] Italian\n");
    printf("> ");
    scanf("%d", &choice);
  } while (choice <= 0 || choice > 2);
  *f = malloc(sizeof(struct functions));
  if (choice == 1) {
    (*f)->greeting = en_greeting;
    (*f)->menu = en_menu;
    (*f)->choose_name = en_choose_name;
  } else {
    (*f)->greeting = ita_greeting;
    (*f)->menu = ita_menu;
    (*f)->choose_name = ita_choose_name;
  }
}

int main(int argc, char **argv) {
  struct data *d;
  struct functions *f;
  int choice;
  choose_language(&f);
  d = malloc(sizeof(struct data));
  f->choose_name();
  scanf("%s", d->name);
  while(1){
    f->greeting(d->name);
    do {
      f->menu();
      scanf("%d", &choice);
    } while (choice <= 0 || choice > 3);
    if (choice == 1) {
      f->choose_name();
      scanf("%s", d->name);
    } else if (choice == 2) {
      choose_language(&f);
    } else {
      free(f);
      free(d);
      break;
    }
  }
  printf("Bye bye!\n");
  return 0;
}
 
